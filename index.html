<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Catfood!</title>
    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.1.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/remarkable/1.6.2/remarkable.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <style type="text/css">
      html, body, button {
        font-family: 'Lato', 'sans-serif';
      }

      .app {
        text-align: center;
        padding: 10px;

        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
      }

      .meal {
        font-size: 48px;

        margin: 20px;
      }

      .button {
        font-size: 24px;
      }
    </style>
    <script type="text/babel">
      const initialStartingDate = new Date(2016, 4, 29);
      const scheduleLength = 7 * 4;
      const morningFeedingTime = 6 * 60 + 45; // 6:45am
      const afternoonFeedingTime = 17 * 60; // 5pm
      const morningFeedingTimeOffset = morningFeedingTime - 2 * 60;
      const afternoonFeedingTimeOffset = afternoonFeedingTime - 2 * 60;

      const chicken = { name: "Chicken Frick 'Azee", color: "#ffde38" },
            turkey = { name: "Fowl Ball", color: "#a57232" },
            pumpkin = { name:"Funk in the Trunk", color: "#098ed0" },
            lamb = { name: "Lamb Burgini", color: "#17ae15" },
            salmon = { name: "Goldie Lox", color: "#efaf39" };

      const weeklySchedule = [
        [chicken, turkey],
        [chicken, chicken],
        [turkey, chicken],
        [chicken, turkey],
        [chicken, chicken],
        [turkey, chicken],
        [chicken, pumpkin],
      ];

      const isThursday = function(date) {
        return date.getDay() == 4;
      };

      const thursdayMeals = function(dayOfSchedule) {
        const week = parseInt(dayOfSchedule / 7);

        if (week == 1) {
          return [lamb, chicken];
        } else if (week == 3) {
          return [salmon, chicken];
        } else {
          return weeklySchedule[4];
        }
      };

      const millisToDays = function(millis) {
        return millis / (86400 * 1000)
      };

      const findDayOfSchedule = function(date) {
        return parseInt(millisToDays(date - initialStartingDate) % scheduleLength);
      };

      const dateToMinutes = function(date) {
        return date.getHours() * 60 + date.getMinutes();
      };

      var App = React.createClass({
        getInitialState: function() {
          return {
            date: new Date(),
            fed: false,
          };
        },
        componentWillMount: function() {
          setInterval(this.updateApp, 1000);
        },
        updateApp: function() {
          const nextDate = new Date();
          const currentMinutes = dateToMinutes(this.state.date);
          const nextMinutes = dateToMinutes(nextDate);
          let isFed = this.state.fed;

          if (currentMinutes < morningFeedingTimeOffset && morningFeedingTimeOffset <= nextMinutes || currentMinutes < afternoonFeedingTimeOffset && afternoonFeedingTimeOffset <= nextMinutes) {
            isFed = false;
          }

          this.setState({ date: nextDate, fed: isFed });
        },
        meals: function() {
          const currentDay = findDayOfSchedule(this.state.date);

          if (isThursday(this.state.date)) {
            return thursdayMeals(currentDay);
          } else {
            return weeklySchedule[currentDay % 7];
          }
        },
        render: function() {
          const meals = this.meals();
          const currentMinutes = dateToMinutes(this.state.date);
          let meal;

          if (currentMinutes <= morningFeedingTimeOffset || currentMinutes < afternoonFeedingTimeOffset) {
            meal = meals[0];
          } else {
            meal = meals[1];
          }

          const backgroundColor = this.state.fed ? '#ececec' : meal.color;

          return (
            <div className="app" style={{background: backgroundColor}}>
              <div className="meal">{meal.name}</div>
              <button
                className="button"
                onClick={() => this.setState({ fed: true })}
                disabled={this.state.fed}>
                  Fed
              </button>
            </div>
          );
        }
      });

      ReactDOM.render(<App />, document.querySelector("#content"));
    </script>
  </body>
</html>
